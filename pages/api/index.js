import Head from 'next/head'
import Link from 'next/link'
// ä»lib/sanity.jså’Œlib/sanity.server.jsæ–‡ä»¶ä¸­å¯¼å…¥sanityClient, urlFor
import {urlFor} from '../lib/sanity'
import {sanityClient} from '../lib/sanity.server'

// è¿™è¡Œä»£ç æ˜¯å¯¹æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼Œ*ä»£è¡¨æŸ¥è¯¢å…¨éƒ¨[]é‡Œé¢å†™æ¡ä»¶,_type=='xxx'æ˜¯å¯¹å“ªä¸ªç±»è¿›è¡ŒæŸ¥è¯¢
// æ‰€ä»¥è¿™è¡Œä»£ç çš„æ„æ€æ˜¯ï¼šæˆ‘è¦æŸ¥è¯¢æ‰€æœ‰çš„recipeï¼š
// const recipesQuery = `*[_type=='recipe]`
// æˆ‘è¦æŸ¥è¯¢æ‰€æœ‰çš„recipeï¼Œå¹¶åªæŸ¥è¯¢nameï¼š
// const recipesQuery = `*[_type=='recipe]{name}`
// æˆ‘è¦æŸ¥è¯¢æ‰€æœ‰çš„recipeï¼Œå¹¶åªä¿ç•™_id, name, slug, mainImageè¿™å‡ ä¸ªå­—æ®µï¼š
const recipesQuery = `*[_type=='recipe']{
  _id,
  name,
  slug,
  mainImage
}`


export default function Home({recipes}) {
  const {_id, name, slug, mainImage} =recipes
  return (
    <div>
      <Head>
        <title>Cong's Kitchen ğŸ</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <h1>Welcome to Cong's Kitchen ğŸ</h1>
      <ul className='recipes-list'>
          {recipes?.length>0 && recipes.map((recipe, index) => (
              <li key={recipe._id} className='recipe-card'>
                  <Link href={`/recipes/${recipe.slug.current}`}>
                      {/*éœ€è¦éœ€è¦ä½¿ç”¨urlFor(mainImage).urlæ¥è·å–urlåœ°å€*/}
                      <a><img src={urlFor(recipe.mainImage).url()} alt={recipe.name}/><span>{recipe.name}</span></a>
                  </Link>
              </li>
          ))}

      </ul>

    </div>
  )
}

export const getStaticProps= async(context)=>{
  // é€šè¿‡sanityClient.fetch(æŸ¥è¯¢è¯­å¥)æ–¹æ³•æ¥æŸ¥è¯¢æ•°æ®
  const recipes=await sanityClient.fetch(recipesQuery)
  return {
    props: {
      recipes
    }
  }
}
